let map=[],marker=[],has_map=[],address_types=[],sg_location_fields=["company","address","city","state","postcode"],billing_lat_element=document.getElementById("sg_billing_lat"),billing_long_element=document.getElementById("sg_billing_long"),shipping_lat_element=document.getElementById("sg_shipping_lat"),shipping_long_element=document.getElementById("sg_shipping_long"),addresses=[],has_billing_map="true"===document.getElementById("sg_billing_map_status").value,has_shipping_map="true"===document.getElementById("sg_shipping_map_status").value;function getSgMapOptions(){let e,n={};return e={},has_billing_map&&document.body.contains(billing_lat_element)&&document.body.contains(billing_long_element)&&(e={...e,billing_lat:""!==billing_lat_element.value?parseFloat(billing_lat_element.value):0,billing_lng:""!==billing_long_element.value?parseFloat(billing_long_element.value):0}),has_shipping_map&&document.body.contains(shipping_lat_element)&&document.body.contains(shipping_long_element)&&(e={...e,shipping_lat:""!==shipping_lat_element.value?parseFloat(shipping_lat_element.value):0,shipping_lng:""!==shipping_long_element.value?parseFloat(shipping_long_element.value):0}),n.position=e,n.zoomlevel=""===document.getElementById("sg_zoom_level").value?13:parseInt(document.getElementById("sg_zoom_level").value),n}function updateMarkerPosition(e,n,t,l){n.setPosition(new google.maps.LatLng(t.lat,t.lng)),e.panTo(new google.maps.LatLng(t.lat,t.lng)),updateInputLatLng(t,l)}function updateInputLatLng(e,n){(document.body.contains(billing_lat_element)&&document.body.contains(billing_long_element)||document.body.contains(shipping_lat_element)&&document.body.contains(shipping_long_element))&&("billing"===n&&document.body.contains(billing_lat_element)&&document.body.contains(billing_long_element)?(billing_lat_element.value=e.lat.toFixed(5),billing_long_element.value=e.lng.toFixed(5),null!==shipping_lat_element&&null!==shipping_long_element&&(shipping_lat_element.value=e.lat.toFixed(5),shipping_long_element.value=e.lng.toFixed(5))):"shipping"===n&&document.body.contains(shipping_lat_element)&&document.body.contains(shipping_long_element)?(shipping_lat_element.value=e.lat.toFixed(5),shipping_long_element.value=e.lng.toFixed(5)):(has_billing_map&&document.body.contains(billing_lat_element)&&document.body.contains(billing_long_element)&&(billing_lat_element.value=e.lat.toFixed(5),billing_long_element.value=e.lng.toFixed(5)),has_shipping_map&&document.body.contains(shipping_lat_element)&&document.body.contains(shipping_long_element)&&(shipping_lat_element.value=e.lat.toFixed(5),shipping_long_element.value=e.lng.toFixed(5))))}function getOrderAddresses(){var e=jQuery("#customer_details").find('select, textarea, input[type="text"]');addresses=[[],[]];let n=[[],[]];return address_types.forEach(((t,l)=>{sg_location_fields.forEach((i=>{for(let a of e)a.id.includes(i)&&a.id.includes(t)&&n[l].push(a)}));for(let i of e)i.id.includes("country")&&i.id.includes(t)&&n[l].push(i);let i=getNewAddressArray(n[l]);addresses[l]={length:i.length-2,address:i.toString(),fields:n[l]}})),addresses}function getNewAddressArray(e){let n=[];for(let t of e)"select"===t.tagName.toLowerCase()?n.push(t.options[t.selectedIndex].text):n.push(t.value);return n=n.filter((e=>""!==e)),n}function updateAddress(e,n,t,l){let i=e;(new google.maps.Geocoder).geocode({address:i},((e,i)=>{"OK"===i&&(n.setCenter(e[0].geometry.location),t.setPosition(e[0].geometry.location),updateInputLatLng({lat:e[0].geometry.location.lat(),lng:e[0].geometry.location.lng()},l))}))}function sgInitMap(){let e,n,t,l=getSgMapOptions(),i="true"===document.getElementById("sg_user_location_autodetect").value;t=[],has_billing_map&&t.push({lat:l.position.billing_lat,lng:l.position.billing_lng}),has_shipping_map&&t.push({lat:l.position.shipping_lat,lng:l.position.shipping_lng}),e={zoom:l.zoomlevel,mapTypeControlOptions:{mapTypeIds:["roadmap","satellite"]}},n={draggable:!0},has_billing_map&&has_map.push(has_billing_map),has_shipping_map&&has_map.push(has_shipping_map);for(const l in address_types)if(has_map[l]){map[l]=new google.maps.Map(document.getElementById("sg_"+address_types[l]+"_map"),{...e,center:t[l]}),marker[l]=new google.maps.Marker({...n,map:map[l],position:t[l]}),marker[l].addListener("dragend",(function(){updateInputLatLng({lat:marker[l].getPosition().lat(),lng:marker[l].getPosition().lng()},address_types[l])}));let i=addresses[l];i.length>0&&updateAddress(i.address,map[l],marker[l],address_types[l]);for(const e of i.fields)e.id.includes("country")||e.id.includes("state")||(e.onchange=function(){updateAddress(getNewAddressArray(i.fields).toString(),map[l],marker[l],address_types[l])})}i&&navigator.geolocation&&navigator.geolocation.getCurrentPosition((e=>{let n={};n={lat:e.coords.latitude,lng:e.coords.longitude};for(const e in address_types)has_map[e]&&(updateMarkerPosition(map[e],marker[e],n,address_types[e]),updateInputLatLng(n,address_types[e]))}),(e=>{}))}function sgclp_detect_marker(e,n){e.preventDefault(),navigator.geolocation.getCurrentPosition((e=>{let t={};t={lat:e.coords.latitude,lng:e.coords.longitude};for(const e in address_types)has_map[e]&&address_types[e]===n&&(updateMarkerPosition(map[e],marker[e],t,address_types[e]),updateInputLatLng(t,address_types[e]))}),(e=>{}))}jQuery(document).ready((function(){document.body.contains(billing_lat_element)&&document.body.contains(billing_long_element)&&address_types.push("billing"),document.body.contains(shipping_lat_element)&&document.body.contains(shipping_long_element)&&address_types.push("shipping"),getOrderAddresses(),sgInitMap()}));